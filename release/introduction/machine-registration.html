<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2013-06-25
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130625" />
    <meta http-equiv="Content-Language" content="en" />
    <title>RoSe - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

              
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../index.html" id="bannerLeft">
                                                                                                <img src="../200px-Rose_logo.png"  alt="RoSe"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-06-25</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.2.3-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Introduction</li>
                                
      <li>
    
                          <a href="../introduction/basic.html" title="What is it for?">
          <i class="none"></i>
        What is it for?</a>
            </li>
                  
      <li>
    
                          <a href="../introduction/terms-and-jargon.html" title="Terms and Jargon">
          <i class="none"></i>
        Terms and Jargon</a>
            </li>
                  
      <li>
    
                          <a href="../introduction/protocols.html" title="Builtin protocols">
          <i class="none"></i>
        Builtin protocols</a>
            </li>
                              <li class="nav-header">Coding</li>
                                
      <li class="active">
    
            <a href="#"><i class="none"></i>Machine registration</a>
          </li>
                  
      <li>
    
                          <a href="../Available-discovery-protocols.html" title="Discovery">
          <i class="none"></i>
        Discovery</a>
            </li>
                              <li class="nav-header">Running Rose</li>
                                
      <li>
    
                          <a href="../configuration/install-rose.html" title="Installing">
          <i class="none"></i>
        Installing</a>
            </li>
                              <li class="nav-header">Understanding deeply</li>
                                
      <li>
    
                          <a href="../introduction/getting-started.html" title="Getting started">
          <i class="none"></i>
        Getting started</a>
            </li>
                  
      <li>
    
                          <a href="../introduction/anatomy.html" title="Rose machine anatomy">
          <i class="none"></i>
        Rose machine anatomy</a>
            </li>
                              <li class="nav-header">Protocols</li>
                                                                                              
      <li>
    
                          <a href="../#" title="Details">
          <i class="icon-chevron-down"></i>
        Details</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../protocol/json-rpc.html" title="JSON-RPC">
          <i class="none"></i>
        JSON-RPC</a>
            </li>
                      
      <li>
    
                          <a href="../protocol/jax-rs.html" title="JAX-RS">
          <i class="none"></i>
        JAX-RS</a>
            </li>
              </ul>
        </li>
                              <li class="nav-header">API/Spec</li>
                                
      <li>
    
                          <a href="../apidocs/index.html" title="Rose API">
          <i class="none"></i>
        Rose API</a>
            </li>
                  
      <li>
    
                          <a href="../spec/dsl-spec.html" title="Rose DSL Spec">
          <i class="none"></i>
        Rose DSL Spec</a>
            </li>
                  
      <li>
    
                          <a href="../spec/Rest-API.html" title="REST API">
          <i class="none"></i>
        REST API</a>
            </li>
                  
      <li>
    
                          <a href="../spec/Rest-inspect-api.html" title="REST Inspect API">
          <i class="none"></i>
        REST Inspect API</a>
            </li>
                  
      <li>
    
                          <a href="../configuration/json-configuration-file.html" title="JSON configuration">
          <i class="none"></i>
        JSON configuration</a>
            </li>
                              <li class="nav-header">Exporters</li>
                                
      <li>
    
                          <a href="../protocol/json-rpc-exporter.html" title="JSON-RPC Exporter">
          <i class="none"></i>
        JSON-RPC Exporter</a>
            </li>
                  
      <li>
    
                          <a href="../protocol/jax-rs.html" title="Jax-Rs Exporter">
          <i class="none"></i>
        Jax-Rs Exporter</a>
            </li>
                              <li class="nav-header">Importers</li>
                                
      <li>
    
                          <a href="../protocol/json-rpc-importer.html" title="JSON-RPC Importer">
          <i class="none"></i>
        JSON-RPC Importer</a>
            </li>
                              <li class="nav-header">Custom components</li>
                                
      <li>
    
                          <a href="../advanced/custom-intro.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="../advanced/discovery-pubsubhubbub.html" title="Discovery">
          <i class="none"></i>
        Discovery</a>
            </li>
                              <li class="nav-header">Modules</li>
                                
      <li>
    
                          <a href="../rose-core/index.html" title="OW2 Chameleon - RoSe Core">
          <i class="none"></i>
        OW2 Chameleon - RoSe Core</a>
            </li>
                  
      <li>
    
                          <a href="../json-configurator/index.html" title="OW2 Chameleon - RoSe Json Configurator">
          <i class="none"></i>
        OW2 Chameleon - RoSe Json Configurator</a>
            </li>
                  
      <li>
    
                          <a href="../jersey-exporter/index.html" title="OW2 Chameleon - RoSe JAX-RS Exporter (jersey)">
          <i class="none"></i>
        OW2 Chameleon - RoSe JAX-RS Exporter (jersey)</a>
            </li>
                  
      <li>
    
                          <a href="../cxf-exporter/index.html" title="OW2 Chameleon - RoSe JAX-WS Exporter (cxf)">
          <i class="none"></i>
        OW2 Chameleon - RoSe JAX-WS Exporter (cxf)</a>
            </li>
                  
      <li>
    
                          <a href="../cxf-importer/index.html" title="OW2 Chameleon - RoSe JAX-WS Importer (cxf)">
          <i class="none"></i>
        OW2 Chameleon - RoSe JAX-WS Importer (cxf)</a>
            </li>
                  
      <li>
    
                          <a href="../jabsorb-exporter/index.html" title="OW2 Chameleon - RoSe JSON-RPC Exporter">
          <i class="none"></i>
        OW2 Chameleon - RoSe JSON-RPC Exporter</a>
            </li>
                  
      <li>
    
                          <a href="../jabsorb-importer/index.html" title="OW2 Chameleon - RoSe JSON-RPC Importer">
          <i class="none"></i>
        OW2 Chameleon - RoSe JSON-RPC Importer</a>
            </li>
                  
      <li>
    
                          <a href="../rose-grizzly-bundle/index.html" title="OW2 Chameleon - Grizzly OSGi HttpService bundle (RoSe version)">
          <i class="none"></i>
        OW2 Chameleon - Grizzly OSGi HttpService bundle (RoSe version)</a>
            </li>
                  
      <li>
    
                          <a href="../atmosgi-parent/index.html" title="Atmosphere OSGi Parent">
          <i class="none"></i>
        Atmosphere OSGi Parent</a>
            </li>
                  
      <li>
    
                          <a href="../rose.dp/index.html" title="OW2 Chameleon - Rose DP">
          <i class="none"></i>
        OW2 Chameleon - Rose DP</a>
            </li>
                                        <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                            
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                    
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Machine Registration</h1>
<p>Considering that RoSe already implements the protocol you will to use, the only thing you have to do is to perform a <b>machine registration</b> and then you are ready to go.</p>
<p>This process is required in order to import or export a service. Although this process remains the same is logical that the parameters for each of them change accordingly. </p>
<h1>Story telling</h1>
<p>Consider you have a webservice, you know everything that is necessary to make use of it. Now, you wish to integrate this service into other applications that have been deployed in a <b>OSGi Service Platform</b>. Well there are two flavours of doing that:</p>

<ol style="list-style-type: decimal">
  
<li>Implement all the service lookup yourself: connecting, manage the possible service faults, then registering that service in the <i>OSGi Service Registry</i></li>
  
<li>Use RoSe, you declare a <b>Machine registration</b> (which can be done in two ways: either you deploy a <b>Rose DSL</b> file or you do the registration programatically), then you are ready to go.</li>
</ol>
<div class="section">
<h2>Machine registering with Rose DSL<a name="Machine_registering_with_Rose_DSL"></a></h2>
<p>In order to use <b>Rose DSL</b> file, its required to deploy the <a class="externalLink" href="http://felix.apache.org/site/apache-felix-file-install.html">fileinstall</a> bundle.</p>
<p>After that, its enough to create a directory named <i>load</i> in the root of your <b>OSGi Service Platform</b> (we use <a class="externalLink" href="http://felix.apache.org/downloads.cgi">felix</a>)</p>
<div class="section">
<h3>File name convention to be respected<a name="File_name_convention_to_be_respected"></a></h3>
<p>So the <b>Rose DSL</b> file is correctly detected by Rose platform is has to be named according to some rules, which are:</p>

<ul>
  
<li>file name should start by &#x201c;rose-conf&#x201d;. <i>e.g.</i> rose-confXXXXXXX</li>
  
<li>file name can be followed by nothing at all or any literal character (from a to z, upper or lower case, or an underscore &quot;_&quot;)</li>
  
<li>file should be placed in the directory required by fileinstall bundle, <i>load</i> by default. <i>e.g.</i> felix/load/rose-conf-jax_rs XXXXXXX</li>
  
<li>file extension must be <i>.json</i> or <i>.rose</i>.</li>
</ul>
<p>For the more experts, the regular expression to be respect is &#x2018;^rose-conf(-[a-zA-Z_0-9]+|).(json|rose)$&#x2019;</p></div>
<div class="section">
<h3>Example 1 - declaring an importer<a name="Example_1_-_declaring_an_importer"></a></h3>

<div class="source">
<pre>    {
	&quot;machine&quot; : {
		&quot;id&quot; : &quot;server1&quot;,
		&quot;host&quot; : &quot;192.168.1.1&quot;,
		
		&quot;connection&quot; : [
				{
				&quot;out&quot; : {
					&quot;service_filter&quot; : &quot;(objectClass=org.osgi.service.log.LogService)&quot;,
				        &quot;properties&quot; : { &quot;tag&quot; : [&quot;log&quot;,&quot;service&quot;,&quot;id&quot;] }
					    }
				},
                 &quot;in&quot; : {
					&quot;endpoint_filter&quot; : &quot;(endpoint.id=*)&quot;
					    }
				}

		],

		&quot;component&quot; : [
			{ 
			  &quot;factory&quot; : &quot;RoSe_importer.jabsorb&quot; 
            },
            { 
			  &quot;factory&quot; : &quot;RoSe_exporter.jabsorb&quot; 
            },
			{ 
			  &quot;factory&quot; : &quot;Rose_Pubsubhubbub.hub&quot;,
			  &quot;properties&quot; : { &quot;hub.url&quot; : &quot;/hub&quot; }
			},
			{ 
			  &quot;factory&quot; : &quot;Rose_Pubsubhubbub.publisher&quot;,
			  &quot;properties&quot; : { &quot;hub.url&quot; : &quot;192.168.1.1:8080/hub/hub:8080/hub&quot;, &quot;rss.url&quot;:&quot;/roserss&quot; }
			},
			{ 
			  &quot;factory&quot; : &quot;Rose_Pubsubhubbub.subscriber&quot;,
			  &quot;properties&quot; : { &quot;callback.url&quot; : &quot;/sub1&quot;, &quot;hub.url&quot;:&quot;192.168.1.1:8080/hub&quot;, &quot;endpoint.filter&quot;:&quot;(endpoint.id=*)&quot; }
			}
		],
	}
    }
</pre></div></div>
<div class="section">
<h3>Example 2 - declaring an exporter<a name="Example_2_-_declaring_an_exporter"></a></h3>

<div class="source">
<pre>{
    &quot;machine&quot;: {
        &quot;id&quot;: &quot;server1&quot;,
        &quot;host&quot;: &quot;localhost&quot;,
        &quot;connection&quot;: [
            {
                &quot;out&quot;: {
                    &quot;service_filter&quot;: &quot;(jaxrs=*)&quot;
                }
            }
        ],
        &quot;component&quot;: [
            {
                &quot;factory&quot;: &quot;RoSe_exporter.jersey&quot;,
                &quot;properties&quot;: {
                    &quot;jersey.servlet.name&quot;: &quot;/rest&quot;
                }
            }
        ]
    }
}
</pre></div></div>
<div class="section">
<h3>Example 3<a name="Example_3"></a></h3>

<div class="source">
<pre>{
    &quot;machine&quot;: {
        &quot;id&quot;: &quot;server1&quot;,
        &quot;host&quot;: &quot;localhost&quot;,
        &quot;connection&quot;: [
            {
                &quot;out&quot;: {
                    &quot;service_filter&quot;: &quot;(jaxrs=*)&quot;
                }
            }
        ],
        &quot;component&quot;: [
            {
                &quot;factory&quot;: &quot;RoSe_exporter.jabsorb&quot;,
                &quot;properties&quot;: {
                    &quot;jersey.servlet.name&quot;: &quot;/rest&quot;
                }
            }
        ]
    }
}
</pre></div></div>
<div class="section">
<h3>Example 4<a name="Example_4"></a></h3>

<div class="source">
<pre>machine: { 
  id: &quot;&quot;,
  host:  &quot;&quot;,
  bind : [
    in : {
      endpoint-filter : &quot;&quot;,	
      customizer : { factory : &quot;&quot;, properties : {} },
      importer : [ { factory = &quot;&quot; } ]
    },
    out : {
      service-filter : &quot;&quot;, 
      exporter : [{ factory : &quot;&quot;, properties : {} }]
    }
  ],
  registry : [{ }]
}
</pre></div></div>
<div class="section">
<h3>Example 5<a name="Example_5"></a></h3>

<div class="source">
<pre>machine {  
  id : &quot;&quot;,
  host : &quot;&quot;,
  
  exporters : [
   {jsonrpc : {type : &quot;rose_jsonrpc_exporter&quot;, properties : {}},
   {rest : {type : &quot;rose_jersey_exporter&quot;}, properties : {}}
  ],

  connection : [
    out : {
      service-filter : &quot;&quot;, 
      exporters : [&quot;json&quot;,&quot;rest&quot;]
    }
  ],
  registry : [{ }]
}
</pre></div></div></div>
<div class="section">
<h2>Machine Registering programatically<a name="Machine_Registering_programatically"></a></h2>
<p>In order to register a Rose Machine programatically, it is necessary to create an OSGi component instance that will be responsible to access Rose and deploy the desired configuration.</p>
<p>Below is an example of how to register an Rose machine programatically.</p>

<div class="source">
<pre>@Component
@Instantiate
public class RoseMachineRegister {

	BundleContext bc;
	Machine m;

	public RoseStarter(BundleContext bc) {
		this.bc = bc;
	}

	@Validate
	public void start() {

		System.out.println(&quot;starting service rose..&quot;);
		
		m = MachineBuilder.machine(bc, &quot;example_helloworld-1&quot;)
				.host(&quot;localhost&quot;).create();
		try {
			m.out(&quot;(jaxrs=*)&quot;).add();
		} catch (InvalidSyntaxException e) {
			e.printStackTrace();
		}
		m.instance(&quot;RoSe_exporter.jersey&quot;).withProperty(&quot;jersey.servlet.name&quot;, &quot;/rest&quot;).create();
		m.start();
		
	}
	
	@Invalidate
	public void stop(){
		if(m!=null){
			System.out.println(&quot;removing machine rose&quot;);
			m.stop();
		}
			
	}
	
}
</pre></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2013
                        <a href="http://www.ow2.org">OW2 Consortium</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
